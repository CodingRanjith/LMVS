<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>LMVR Eye Care</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/information/eye.jpg" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>

<body class="index-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center">
          <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">liginj25@jnn.edu.in</a></i>
          <i class="bi bi-phone d-flex align-items-center ms-4"><span> 8056805054</span></i>
        </div>
        <div class="social-links d-none d-md-flex align-items-center">
          <!-- <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
          <a href="#" class="facebook"><i class="bi bi-facebook"></i></a> -->
          <a href="https://www.instagram.com/__mr_ligin__/profilecard/?igsh=cjF4YWhiZmthanJr"  target="_blank" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://www.linkedin.com/in/ligin-ij-557286291" target="_blank" class="linkedin">
            <i class="bi bi-linkedin"></i>
          </a>
          
        </div>
      </div>
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-center">

      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.png" alt=""> -->
          <h1 class="sitename">LMVR Eye Care</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="/" class="active">Tonometry<br></a></li>
            <li><a href="patient-detail.html">Patient detail</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <a class="cta-btn d-none d-sm-block" href="result.html">Result</a>

      </div>

    </div>

  </header>

  <main class="main">
    <section id="result" class="section">
      <div class="container">
        <h2 class="text-center mb-4">Patient Results</h2>
    
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Name</th><th>DOB</th><th>Age</th><th>Sex</th><th>Email</th>
              <th>Cell</th><th>IOP Range</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="resultTableBody"></tbody>
          
        </table>
    
        <canvas id="iopChart" height="100"></canvas>
      </div>
    </section>

  <!-- Patient Details Modal -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="patientModalLabel">Patient Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div id="patientDetails" class="mb-4"></div>
        <canvas id="individualChart" height="100"></canvas>
      </div>

    </div>
  </div>
</div>


    
  </main>

<footer id="footer" class="footer light-background">

  <div class="container copyright text-center mt-4">
    <div class="credits">
      Developed by <a href="https://www.linkedin.com/in/ligin-ij-557286291?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app">Ligin</a>
    </div>
  </div>

</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const patients = JSON.parse(localStorage.getItem("patients")) || [];
  const tbody = document.getElementById("resultTableBody");

  // Populate table with patient rows
  patients.forEach((p, index) => {
    const row = `
      <tr>
        <td>${p.name}</td>
        <td>${p.dob}</td>
        <td>${p.age}</td>
        <td>${p.sex}</td>
        <td>${p.email}</td>
        <td>${p.cell}</td>
        <td>${p.iop}</td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="showDetails(${index})" data-bs-toggle="modal" data-bs-target="#patientModal">
            View
          </button>
        </td>
      </tr>
    `;
    tbody.innerHTML += row;
  });

  let individualChart; // To hold chart instance for modal

  function showDetails(index) {
    const p = patients[index];

    // Set HTML content
    const detailsHTML = `
      <p><strong>Name:</strong> ${p.name}</p>
      <p><strong>Date of Birth:</strong> ${p.dob}</p>
      <p><strong>Age:</strong> ${p.age}</p>
      <p><strong>Sex:</strong> ${p.sex}</p>
      <p><strong>Email:</strong> ${p.email}</p>
      <p><strong>Address:</strong> ${p.address || 'N/A'}</p>
      <p><strong>Cell:</strong> ${p.cell}</p>
      <p><strong>Work Phone:</strong> ${p.work || 'N/A'}</p>
      <p><strong>Authorized Contact:</strong> ${p.authorized || 'N/A'}</p>
      <p><strong>IOP Range:</strong> ${p.iop}</p>
    `;
    document.getElementById("patientDetails").innerHTML = detailsHTML;

    // Destroy previous chart
    if (individualChart) individualChart.destroy();

    // Prepare chart data
    const iopData = {
      Normal: p.iop.includes("Normal") ? 1 : 0,
      Glaucoma: p.iop.includes("Glaucoma") ? 1 : 0,
      Hypotony: p.iop.includes("Hypotony") ? 1 : 0
    };

    // Draw chart inside modal
    const ctx = document.getElementById("individualChart").getContext("2d");
    individualChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Normal", "Glaucoma", "Hypotony"],
        datasets: [{
          label: "IOP Classification",
          data: [iopData.Normal, iopData.Glaucoma, iopData.Hypotony],
          backgroundColor: ["#198754", "#ffc107", "#dc3545"]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1, precision: 0 }
          }
        }
      }
    });
  }

  // Draw main summary chart at bottom of page
  const iopCounts = { Normal: 0, Glaucoma: 0, Hypotony: 0 };
  patients.forEach(p => {
    if (p.iop.includes("Normal")) iopCounts.Normal++;
    if (p.iop.includes("Glaucoma")) iopCounts.Glaucoma++;
    if (p.iop.includes("Hypotony")) iopCounts.Hypotony++;
  });

  new Chart(document.getElementById("iopChart").getContext("2d"), {
    type: "bar",
    data: {
      labels: ["Normal", "Glaucoma", "Hypotony"],
      datasets: [{
        label: "Patient IOP Summary",
        data: [iopCounts.Normal, iopCounts.Glaucoma, iopCounts.Hypotony],
        backgroundColor: ["#198754", "#ffc107", "#dc3545"]
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1, precision: 0 }
        }
      }
    }
  });
</script>




<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>