<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>LMVR Eye Care</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/information/eye.jpg" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

</head>

<body class="index-page">

  <header id="header" class="header sticky-top">

    <div class="topbar d-flex align-items-center">
      <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center">
          <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">liginj25@jnn.edu.in</a></i>
          <i class="bi bi-phone d-flex align-items-center ms-4"><span> 8056805054</span></i>
        </div>
        <div class="social-links d-none d-md-flex align-items-center">
          <!-- <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
          <a href="#" class="facebook"><i class="bi bi-facebook"></i></a> -->
          <a href="https://www.instagram.com/__mr_ligin__/profilecard/?igsh=cjF4YWhiZmthanJr"  target="_blank" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://www.linkedin.com/in/ligin-ij-557286291" target="_blank" class="linkedin">
            <i class="bi bi-linkedin"></i>
          </a>
          
        </div>
      </div>
    </div><!-- End Top Bar -->

    <div class="branding d-flex align-items-center">

      <div class="container position-relative d-flex align-items-center justify-content-between">
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <!-- Uncomment the line below if you also wish to use an image logo -->
          <!-- <img src="assets/img/logo.png" alt=""> -->
          <h1 class="sitename">LMVR Eye Care</h1>
        </a>

        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="/" class="active">Tonometry<br></a></li>
            <li><a href="patient-detail.html">Patient detail</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

        <a class="cta-btn d-none d-sm-block" href="result.html">Result</a>

      </div>

    </div>

  </header>

  <main class="main">
    <section id="result" class="section">
      <div class="container">
        <h2 class="text-center mb-4">Patient Results</h2>
    
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Name</th><th>DOB</th><th>Age</th><th>Sex</th><th>Email</th>
              <th>Cell</th><th>IOP Range</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="resultTableBody"></tbody>
          
        </table>
    
        <canvas id="iopChart" height="100"></canvas>
      </div>
    </section>

 <!-- Patient Modal -->
<div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="patientModalLabel">Patient Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="container">
          <div class="row gy-2" id="patientDetails">
            <!-- JS dynamically inserts the split rows here -->
          </div>

          <hr class="my-4">

          <h6 class="text-center">IOP Category Chart</h6>
          <canvas id="individualChart" height="150"></canvas>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- IOP Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Update IOP Range</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p>Randomly generate a new IOP range:</p>
        <h4 id="generatedIOP" class="fw-bold text-primary"></h4>
        <div class="mt-3">
          <button class="btn btn-outline-secondary" onclick="refreshIOP()">ðŸ”„ Refresh</button>
          <button class="btn btn-success ms-2" onclick="submitIOP()">âœ… Submit</button>
        </div>
      </div>
    </div>
  </div>
</div>




    
  </main>

<footer id="footer" class="footer light-background">

  <div class="container copyright text-center mt-4">
    <div class="credits">
      Developed by <a href="https://www.linkedin.com/in/ligin-ij-557286291?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app">Ligin</a>
    </div>
  </div>

</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const patients = JSON.parse(localStorage.getItem("patients")) || [];
  const tbody = document.getElementById("resultTableBody");
  let currentIndex = null;
  let individualChart = null;

  // Draw Table Rows with View Buttons
  patients.forEach((p, index) => {
    const row = `
      <tr>
        <td>${p.name}</td>
        <td>${p.dob}</td>
        <td>${p.age}</td>
        <td>${p.sex}</td>
        <td>${p.email}</td>
        <td>${p.cell}</td>
        <td>${p.iop}</td>
        <td>
          <button class="btn btn-sm btn-primary" onclick="showDetails(${index})" data-bs-toggle="modal" data-bs-target="#patientModal">
            View
          </button>
          <button class="btn btn-sm btn-warning" onclick="openIOPUpdate(${index})" data-bs-toggle="modal" data-bs-target="#updateModal">Update IOP</button>
        </td>
      </tr>
    `;
    tbody.innerHTML += row;
  });

  // Show Details Function
  function showDetails(index) {
    currentIndex = index;
    const p = patients[index];

    const html = `
      <div class="col-md-6"><strong>Name:</strong> ${p.name}</div>
      <div class="col-md-6"><strong>DOB:</strong> ${p.dob}</div>
      <div class="col-md-6"><strong>Age:</strong> ${p.age}</div>
      <div class="col-md-6"><strong>Sex:</strong> ${p.sex}</div>
      <div class="col-md-6"><strong>Email:</strong> ${p.email}</div>
      <div class="col-md-6"><strong>Cell:</strong> ${p.cell}</div>
      <div class="col-md-6"><strong>Work:</strong> ${p.work || "N/A"}</div>
      <div class="col-md-6"><strong>Address:</strong> ${p.address || "N/A"}</div>
      <div class="col-md-6"><strong>Authorized:</strong> ${p.authorized || "N/A"}</div>
      <div class="col-md-6"><strong>IOP Range:</strong> ${p.iop}</div>
    `;
    document.getElementById("patientDetails").innerHTML = html;
  }

  // When Modal Fully Shown â†’ Render Chart
  const patientModal = document.getElementById("patientModal");
  patientModal.addEventListener("shown.bs.modal", function () {
    const p = patients[currentIndex];
    drawIndividualChart(p.iop);
  });

  // Draw Chart in Modal
  function drawIndividualChart(iopLabel) {
    const ctx = document.getElementById("individualChart").getContext("2d");

    if (individualChart) individualChart.destroy();

    const iopData = {
      Normal: iopLabel.includes("Normal") ? 1 : 0,
      Glaucoma: iopLabel.includes("Glaucoma") ? 1 : 0,
      Hypotony: iopLabel.includes("Hypotony") ? 1 : 0,
    };

    individualChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Normal", "Glaucoma", "Hypotony"],
        datasets: [{
          label: "IOP Classification",
          data: [iopData.Normal, iopData.Glaucoma, iopData.Hypotony],
          backgroundColor: ["#198754", "#ffc107", "#dc3545"]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1, precision: 0 }
          }
        }
      }
    });
  }

  // Draw Summary Chart
  const summaryCounts = { Normal: 0, Glaucoma: 0, Hypotony: 0 };
  patients.forEach(p => {
    if (p.iop.includes("Normal")) summaryCounts.Normal++;
    if (p.iop.includes("Glaucoma")) summaryCounts.Glaucoma++;
    if (p.iop.includes("Hypotony")) summaryCounts.Hypotony++;
  });

  const ctxSummary = document.getElementById("iopChart").getContext("2d");
  new Chart(ctxSummary, {
    type: "bar",
    data: {
      labels: ["Normal", "Glaucoma", "Hypotony"],
      datasets: [{
        label: "Patient IOP Summary",
        data: [summaryCounts.Normal, summaryCounts.Glaucoma, summaryCounts.Hypotony],
        backgroundColor: ["#198754", "#ffc107", "#dc3545"]
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: true } },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1, precision: 0 }
        }
      }
    }
  });


let selectedIOP = null;

const iopRanges = [
  { label: "Normal: 11â€“20 mmHg", code: "Normal" },
  { label: "Glaucoma: 21â€“30 mmHg", code: "Glaucoma" },
  { label: "Hypotony: 5â€“10 mmHg", code: "Hypotony" }
];

function openIOPUpdate(index) {
  currentIndex = index;
  refreshIOP();
}

// Generate a random IOP range
function refreshIOP() {
  const random = iopRanges[Math.floor(Math.random() * iopRanges.length)];
  selectedIOP = random;
  document.getElementById("generatedIOP").textContent = random.label;
}

// Submit new IOP and update chart + table
function submitIOP() {
  if (selectedIOP && currentIndex !== null) {
    patients[currentIndex].iop = selectedIOP.label;
    localStorage.setItem("patients", JSON.stringify(patients));
    location.reload(); // Reload to reflect updated chart and table
  }
}

</script>






<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>